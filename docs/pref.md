# Performance Optimization

<!--
我们将任务分为如下五种类型：

1. 轻量级同步任务：仅仅执行一些简单的计算或数据处理，执行时间非常短，无须计算资源。适用于对其他任务结果的简单汇总。
2. 计算密集型同步任务：需要进行计算，需要占据计算资源，执行时间可能较长。适用于需要根据模型生成结果进行计算的场景。
3. I/O密集型异步任务：需要进行I/O操作，多数执行时间用于等待I/O操作完成。适用于需要对外部资源进行访问来获取数据的场景，如调用 API 实现 LLM-as-a-Judge 评测。
4. 计算密集型批量同步任务：需要批量进行计算，需要占据计算资源，执行时间可能较长。适用于需要进行计算，且用于计算的程序内部实现了并行机制，因此需要批量提供数据进行计算的场景。
5. I/O密集型批量异步任务：需要批量进行I/O操作。与计算密集型批量任务类似，但需要调用外部接口来进行批量处理。

根据每一种任务的特点，我们选用合适的执行方式来执行这些任务：

1. 轻量级同步任务：在主节点中启动一个线程池执行这些任务，同时设置 `chunksize=64` 以降低线程切换的开销。
2. 计算密集型同步任务：将这些任务作为 Task 交由 Ray 进行调度和执行，Ray 会自动选择合适的资源来执行这些任务。
3. I/O密集型异步任务：启动一个 Ray Actor 提供事件循环，将这些任务在该 Actor 中异步执行。
4. 计算密集型批量同步任务：启动一个 `Receiver` Actor，在其上异步执行多个 Receiver，作用为等待批量同步执行后的单个结果；同时启动一个独立的 Actor 用于批量执行计算密集型任务，交由 Ray 进行调度和执行。
5. I/O密集型批量异步任务：与计算密集型批量同步任务类似，不同之处在于用于执行批量任务的 Task 将不会被 Ray 单独调度，而是与 Receiver 放在同一个事件循环中执行。

如果你的评估任务包含了多种任务的特征，比如需要先请求 API 之后再进行大量计算，那么你可以将这些任务拆分成多个子任务，分别使用不同的执行方式来执行。这样可以充分利用 Ray 的并行能力，提高评估效率。
 -->
